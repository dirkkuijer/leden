{% extends 'layout.html.twig' %}
    {% block stylesheet %}
        <link rel="stylesheet" type="text/css" href="{{ asset("css/main.css") }}">
    {% endblock %}

{% block body %}
    <h3>Lid bewerken</h3>

    <div class="grid-x grid-padding-x">
            <div class="cell medium-2">
                <a href="{{ path('member_index') }}">Terug naar lijst</a>
            </div>
            <div class="cell medium-10"></div>
    </div>
<p>


{% if is_granted('ROLE_ADMIN') %}
    {{ form_start(edit_form) }}

            
          <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.firstName) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.firstName) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.lastName) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.lastName) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.email) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.email) }}
                {{ form_errors(edit_form.email) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.street) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.street) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.houseNumber) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.houseNumber) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.houseNumberAddition) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.houseNumberAddition) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.zipCode) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.zipCode) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.city) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.city) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.telephone) }}
            </div>
            <div class="cell medium-3">
                {{ form_widget(edit_form.telephone) }}
            </div>
        <div class="cell medium-3"></div>
    </div>
    
  
    <div class="grid-x grid-padding-x">
        <div class="cell medium-4"></div>
            <div class="cell medium-2">
                {{ form_label(edit_form.dateOfBirth) }}
            </div>
                <div class="cell medium-3">
                    {{ form_widget(edit_form.dateOfBirth) }}
                </div>
        <div class="cell medium-3"></div>
    </div>

     {# Second form for dates and reason membership #}
<p>
{# Second form with the dates and reasons #}
        {% import _self as forms %}
        {% macro memberTypeRow(widget) %}
        
            {% if widget.vars.prototype is defined %}
                {% set form = widget.vars.prototype %}
                {% set name = widget.vars.prototype.vars.name %}
            {% else %}
                {% set form = widget %}
                {% set name = widget.vars.full_name %}
            {% endif %} 


<div data-content="{{ name }}"  class="panel panel-default">
    <div class="panel-body">
        <div class="collection-item">

                <div class="grid-x grid-padding-x">
                    <div class="cell medium-4"></div>
                        <div class="cell medium-4">
                            <h5>Datums:</h5>
                        </div>
                    <div class="cell medium-8"></div>
                </div>
{# first field: fromDate #}
                <div class="grid-x grid-padding-x">
                    <div class="cell medium-4"></div>
                    <div class="cell medium-2">
                        {{ form_label(form.fromDate) }}
                        {{ form_errors(form.fromDate) }}
                    </div>
                        <div class="cell medium-3">
                            {{ form_widget(form.fromDate) }}
                        </div>
                        <div class="cell medium-3"></div>
                    </div>
{# second field: tillDate #}
                 <div class="grid-x grid-padding-x">
                    <div class="cell medium-4"></div>
                    <div class="cell medium-2">
                        {{ form_label(form.tillDate) }}
                        {{ form_errors(form.tillDate) }}
                    </div>
                        <div class="cell medium-3">
                            {{ form_widget(form.tillDate) }}
                        </div>
                        <div class="cell medium-3"></div>
                    </div>
{# third field: reason #}
                <div class="grid-x grid-padding-x">
                        <div class="cell medium-4"></div>
                            <div class="cell medium-2">
                                {{ form_label(form.reason) }}
                                {{ form_errors(form.reason) }}
                            </div>
                            <div class="cell medium-3">
                                {{ form_widget(form.reason) }}
                            </div>
                        <div class="cell medium-3"></div>
                </div>
            </div>
{#  title third form#}
            <div class="grid-x grid-padding-x">
                <div class="cell medium-4"></div>
                <div class="cell medium-2">
                    <h5>Soort lid:</h5>
                </div>
                <div class="cell medium-8"></div>
            </div>
{# fourth field: memberType #}
                <div class="grid-x grid-padding-x">
                    <div class="cell medium-4"></div>
                        <div class="cell medium-2">
                            {{ form_label(form.memberType) }}
                            {{ form_errors(form.memberType) }}
                        </div>
                        <div class="cell medium-3">
                            {{ form_widget(form.memberType) }}
                        </div>
                    <div class="cell medium-3"></div>
                </div>

            {# gekopieerd uit new.html.twig #}
        <div class="grid-x grid-padding-x">
            <div class="cell medium-8"></div>
                <div class="cell medium-2">
                    <a href="javascript:void(0);" class="button tiny collection-remove"
                    data-collection-item-class="collection-item">- Eigenschappen</a>
                </div>
            <div class="cell medium-2"></div>
        </div>

{% endmacro %}

      
                    <div id="memberTypes" data-prototype="
                        {{ forms.memberTypeRow(edit_form.type.vars.prototype)|e('html_attr') }}">
                        {% for type in edit_form.type %}
                            {{ form_row(edit_form.type) }}
                        {% endfor %}
                    </div>
                    
            <div class="grid-x grid-padding-x">
                <div class="cell medium-8"></div>    
                <div class="cell medium-2">    
                    <a href="#" class="button tiny" id="collection-add" data-collection="memberTypes" data-index="{{ edit_form.type|length }}">
                        + Eigenschappen</a>
                </div>
                <div class="cell medium-2">  
                </div>
            </div>

        </div>
    </div>       
</div>
{# end second form #}

    {# submit button all forms #}

    {{ form_end(edit_form) }}

    <script>
 
        jQuery(document).ready(function() {
            $(document).on('click', '#collection-add', function () {

                console.log('Item toegevoegd.');

                var $collectionContainer = $('#' + $(this).data('collection'));
               // hier gebruike we de tweede regel niet.
                var insertOrder = $(this).data('insert-order') || 'last';
                var prototype = $collectionContainer.attr('data-prototype');
                var prototypeName = $collectionContainer.attr('data-prototype-name') || '__name__';


                var lastCollectionItem = $collectionContainer.children().last();
                var lastCollectionItemInputName = $('input', lastCollectionItem).first().attr('name');

                var newIndex = 0;

                if (!$collectionContainer.attr('data-index')) {
                    if ($collectionContainer.children().length > 0) {
                        var prototypeInputName = $('input', $(prototype)).first().attr('name');
                        var splittedStr = prototypeInputName.split(prototypeName);
                        var leftSideStr = splittedStr[0];
                        var rightSideStr = splittedStr[1];

                        newIndex = parseInt(lastCollectionItemInputName.replace(leftSideStr, '').replace(rightSideStr, '')) + 1;
                    }
                } else {
                    /* NEWERER method to determine next input index */
                    $collectionContainer.attr('data-index', function(idx, val) {
                        newIndex = parseInt(val) + 1
                        return newIndex
                    });
                }

                var prototypeRegExp = new RegExp(prototypeName, "g");
                var item = prototype.replace(prototypeRegExp, newIndex);

                if (insertOrder == 'last' || (typeof insertOrder === typeof undefined && insertOrder === false)) {
                    $collectionContainer.append(item);
                } else {
                    $collectionContainer.prepend(item);
                }

                return false;
            });

            $(document).on('click', '.collection-remove', function () {
                var $collectionItem = $(this).closest('.' + $(this).data('collection-item-class'));
                $collectionItem.remove();

                return false;
            });
        });
 
    </script>


    <div class="grid-x grid-padding-x">
        <div class="cell medium-6"></div>
            <div class="cell medium-2">  
                <input class="button" type="submit" value="Opslaan"/>
                {{ form_end(edit_form) }}
            </div> 
        <div class="cell medium-1"> {{ form_start(delete_form) }}
                <input class="button" type="submit" value="Verwijderen" />
            {{ form_end(delete_form) }}</div>   
    <div class="cell medium-3"></div>
           
    {% else %}
<p> U bent niet bevoegd om deze inhoud te zien of te bewerken. </p>

{% endif %}
<p>
{% endblock %}
